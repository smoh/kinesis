<!doctype html>
<html class="no-js">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />
<link rel="index" title="Index" href="genindex.html" /><link rel="search" title="Search" href="search.html" /><link rel="next" title="Getting started with Kinesis" href="tutorial.html" /><link rel="prev" title="Installing kinesis" href="install.html" />

    <meta name="generator" content="sphinx-4.1.2, furo 2021.08.11.beta42"/>
        <title>Making a mock cluster - kinesis documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/styles/furo.css?digest=197f00461d56902ea7ca048ec6e6ba026f62c97b" />
    <link rel="stylesheet" type="text/css" href="_static/styles/furo-extensions.css?digest=93475b62d1c3bc01323a0eefdc14a62d77b12690" />
    
    


<style>
  body {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  
  }
  body[data-theme="dark"] {
    --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
  }
  @media (prefers-color-scheme: dark) {
    body:not([data-theme="light"]) {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
  }
</style>
    <link media="(prefers-color-scheme: dark)" rel="stylesheet" href="_static/pygments_dark.css"></head>
  <body>
    
<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
      <path stroke="none" d="M0 0h24v24H0z" />
      <line x1="4" y1="6" x2="20" y2="6" />
      <line x1="10" y1="12" x2="20" y2="12" />
      <line x1="6" y1="18" x2="20" y2="18" />
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-half" viewBox="0 0 24 24">
    <title>Auto light/dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-shadow">
      <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
      <circle cx="12" cy="12" r="9" />
      <path d="M13 12h5" />
      <path d="M13 15h4" />
      <path d="M13 18h1" />
      <path d="M13 9h4" />
      <path d="M13 6h1" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="index.html"><div class="brand">kinesis  documentation</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="index.html">
  
  
  <span class="sidebar-brand-text">kinesis  documentation</span>
  
</a><form class="sidebar-search-container" method="get" action="search.html" role="search">
  <input class="sidebar-search" placeholder=Search name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="install.html">Installing kinesis</a></li>
<li class="toctree-l1 current current-page"><a class="current reference internal" href="#">Making a mock cluster</a></li>
<li class="toctree-l1"><a class="reference internal" href="tutorial.html">Getting started with Kinesis</a></li>
<li class="toctree-l1"><a class="reference internal" href="models.html">Available models</a></li>
<li class="toctree-l1"><a class="reference internal" href="api.html">API documentation</a></li>
</ul>

</div>
</div>
      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <article role="main">
        <div class="content-icon-container">
          <div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput.container div.prompt *,
div.nboutput.container div.prompt *,
div.nbinput.container div.input_area pre,
div.nboutput.container div.output_area pre,
div.nbinput.container div.input_area .highlight,
div.nboutput.container div.output_area .highlight {
    border: none;
    padding: 0;
    margin: 0;
    box-shadow: none;
}

div.nbinput.container > div[class*=highlight],
div.nboutput.container > div[class*=highlight] {
    margin: 0;
}

div.nbinput.container div.prompt *,
div.nboutput.container div.prompt * {
    background: none;
}

div.nboutput.container div.output_area .highlight,
div.nboutput.container div.output_area pre {
    background: unset;
}

div.nboutput.container div.output_area div.highlight {
    color: unset;  /* override Pygments text color */
}

/* avoid gaps between output lines */
div.nboutput.container div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput.container,
div.nboutput.container {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput.container,
    div.nboutput.container {
        flex-direction: column;
    }
}

/* input container */
div.nbinput.container {
    padding-top: 5px;
}

/* last container */
div.nblast.container {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput.container div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput.container div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput.container div.prompt,
div.nboutput.container div.prompt {
    width: 4.5ex;
    padding-top: 5px;
    position: relative;
    user-select: none;
}

div.nbinput.container div.prompt > div,
div.nboutput.container div.prompt > div {
    position: absolute;
    right: 0;
    margin-right: 0.3ex;
}

@media (max-width: 540px) {
    div.nbinput.container div.prompt,
    div.nboutput.container div.prompt {
        width: unset;
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput.container div.prompt.empty {
        padding: 0;
    }

    div.nbinput.container div.prompt > div,
    div.nboutput.container div.prompt > div {
        position: unset;
    }
}

/* disable scrollbars on prompts */
div.nbinput.container div.prompt pre,
div.nboutput.container div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput.container div.input_area,
div.nboutput.container div.output_area {
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput.container div.input_area,
    div.nboutput.container div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput.container div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    /*background: #f5f5f5;*/
}

/* override MathJax center alignment in output cells */
div.nboutput.container div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput.container div.math p {
    text-align: left;
}

/* standard error */
div.nboutput.container div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }


div.nbinput.container div.input_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight].math,
div.nboutput.container div.output_area.rendered_html,
div.nboutput.container div.output_area > div.output_javascript,
div.nboutput.container div.output_area:not(.rendered_html) > img{
    padding: 5px;
    margin: 0;
}

/* fix copybtn overflow problem in chromium (needed for 'sphinx_copybutton') */
div.nbinput.container div.input_area > div[class^='highlight'],
div.nboutput.container div.output_area > div[class^='highlight']{
    overflow-y: hidden;
}

/* hide copybtn icon on prompts (needed for 'sphinx_copybutton') */
.prompt a.copybtn {
    display: none;
}

/* Some additional styling taken form the Jupyter notebook CSS */
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
div.rendered_html th {
  font-weight: bold;
}
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}
</style>
<section id="Making-a-mock-cluster">
<h1>Making a mock cluster<a class="headerlink" href="#Making-a-mock-cluster" title="Permalink to this headline">¶</a></h1>
<p>In this notebook, we will run through the utility available in kinesis to quickly make mock cluster observations. Using this, we will examine the perspective effect of cluster mean velocity.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="o">%</span><span class="k">load_ext</span> autoreload
<span class="o">%</span><span class="k">autoreload</span> 2
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="o">%</span><span class="k">matplotlib</span> inline
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">colors</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">astropy.units</span> <span class="k">as</span> <span class="nn">u</span>
<span class="kn">import</span> <span class="nn">astropy.coordinates</span> <span class="k">as</span> <span class="nn">coords</span>
<span class="kn">import</span> <span class="nn">arviz</span> <span class="k">as</span> <span class="nn">az</span>

<span class="c1"># project dependencies</span>
<span class="kn">import</span> <span class="nn">gapipes</span> <span class="k">as</span> <span class="nn">gp</span>
<span class="kn">import</span> <span class="nn">kinesis</span> <span class="k">as</span> <span class="nn">kn</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">plt</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">use</span><span class="p">([</span><span class="s1">'science'</span><span class="p">,</span><span class="s1">'high-contrast'</span><span class="p">,</span><span class="s1">'no-latex'</span><span class="p">,</span><span class="s1">'notebook'</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">18324</span><span class="p">)</span>
</pre></div>
</div>
</div>
<section id="Making-and-observing-a-mock-cluster">
<h2>Making and observing a mock cluster<a class="headerlink" href="#Making-and-observing-a-mock-cluster" title="Permalink to this headline">¶</a></h2>
<p>First, let’s make a cluster with some fiducial parameters.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">N</span> <span class="o">=</span> <span class="mi">150</span>  <span class="c1"># number of sources</span>
<span class="n">b0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">17.7</span><span class="p">,</span> <span class="mf">41.2</span><span class="p">,</span> <span class="mf">13.3</span><span class="p">])</span>    <span class="c1"># pc</span>
<span class="n">v0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="mf">6.32</span><span class="p">,</span> <span class="mf">45.24</span><span class="p">,</span> <span class="mf">5.30</span><span class="p">])</span>  <span class="c1"># [vx, vy, vz] in km/s</span>
<span class="n">sigv</span> <span class="o">=</span> <span class="mf">1.</span>  <span class="c1"># dispersion, km/s</span>

<span class="n">cl</span> <span class="o">=</span> <span class="n">kn</span><span class="o">.</span><span class="n">Cluster</span><span class="p">(</span><span class="n">v0</span><span class="p">,</span> <span class="n">sigv</span><span class="p">,</span> <span class="n">b0</span><span class="o">=</span><span class="n">b0</span><span class="p">)</span>
<span class="n">cl</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Cluster(b0=[17.7 41.2 13.3], v0=[-6.32 45.24  5.3 ], sigmav=1.0)
</pre></div></div>
</div>
<p>The cluster currently has no members. We need to ‘sample’ the cluster in order to populate it. There are two methods for sampling a cluster:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">sample_sphere</span></code>: sampling uniformly within a maximum radius</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">sample_at</span></code>: sample at exactly the positions you want by giving it astropy coordinates.</p></li>
</ul>
<p>Let’s do uniform sphere for now. All normal methods of <code class="docutils literal notranslate"><span class="pre">Cluster</span></code> will return itself with modified attributes for method chaining. Sampling will modify its <code class="docutils literal notranslate"><span class="pre">members</span></code> from <code class="docutils literal notranslate"><span class="pre">None</span></code> to an instance of <code class="docutils literal notranslate"><span class="pre">ClusterMembers</span></code>.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">cl</span><span class="o">.</span><span class="n">sample_sphere</span><span class="p">(</span><span class="n">N</span><span class="o">=</span><span class="n">N</span><span class="p">,</span> <span class="n">Rmax</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
<span class="n">cl</span><span class="o">.</span><span class="n">members</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;kinesis.mock.ClusterMembers at 0x7f7f3d8dc050&gt;
</pre></div></div>
</div>
<p>There are two Gaia-like DataFrame associated with <code class="docutils literal notranslate"><span class="pre">ClusterMembers</span></code>: - <code class="docutils literal notranslate"><span class="pre">truth</span></code>: this is the noise-free Gaia data consistent with the <code class="docutils literal notranslate"><span class="pre">Cluster</span></code>’s internal motions - <code class="docutils literal notranslate"><span class="pre">observed</span></code>: this is the noise-added Gaia data. If the <code class="docutils literal notranslate"><span class="pre">ClusterMembers</span></code> has not been <code class="docutils literal notranslate"><span class="pre">observe</span></code>d, it will be <code class="docutils literal notranslate"><span class="pre">None</span></code>.</p>
<p>Now let’s <code class="docutils literal notranslate"><span class="pre">observe</span></code> the cluster. In order to observe, you need to specify the 3x3 covariance matrix for (parallax, pmra, pmdec) with <code class="docutils literal notranslate"><span class="pre">cov</span></code> keyword. If <code class="docutils literal notranslate"><span class="pre">cov</span></code> is (3,3) array, this will be assumed for all stars. You can also specify different covariance matrix for different stars by specifying <code class="docutils literal notranslate"><span class="pre">cov</span></code> to be (N, 3, 3) array. The noise model is assumed to be Gaussian.</p>
<p>It is also possible to specify covariance by giving another Gaia-like data frame using <code class="docutils literal notranslate"><span class="pre">error_from</span></code> keyword. The following columns needed to construct to covariance matrix are expected: <code class="docutils literal notranslate"><span class="pre">parallax_error</span></code>, <code class="docutils literal notranslate"><span class="pre">pmra_error</span></code>, <code class="docutils literal notranslate"><span class="pre">pmdec_error</span></code>, <code class="docutils literal notranslate"><span class="pre">parallax_pmra_corr</span></code>, <code class="docutils literal notranslate"><span class="pre">parallax_pmdec_corr</span></code>, <code class="docutils literal notranslate"><span class="pre">pmra_pmdec_corr</span></code>. This is useful, for example, if you want to simulate data as noisy as the actual Gaia data you want to model.</p>
<p>Radial velocity errors should be specified separately with <code class="docutils literal notranslate"><span class="pre">rv_error</span></code> keyword, which should be 1-d array with <code class="docutils literal notranslate"><span class="pre">N</span></code> elements, each specifying the Gaussian standard deviation in km/s. If any element in <code class="docutils literal notranslate"><span class="pre">rv_error</span></code> is <code class="docutils literal notranslate"><span class="pre">np.nan</span></code>, it is assumed that the star does not have RV measurement.</p>
<p>This will add noise to the astrometry and radial velocities of the cluster members, and the noise-added Gaia-like data frame is now accessible with <code class="docutils literal notranslate"><span class="pre">cl.members.observed</span></code>.</p>
<p>Let’s specify simply 0.01 mas or mas/yr errors for parallax and pmra/pmdec and no available RVs.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">cl</span><span class="o">.</span><span class="n">observe</span><span class="p">(</span><span class="n">cov</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">*</span><span class="mf">0.01</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Cluster(b0=[17.7 41.2 13.3], v0=[-6.32 45.24  5.3 ], sigmav=1.0)
</pre></div></div>
</div>
<p>Now we have a Gaia-like data in pandas DataFrame in <code class="docutils literal notranslate"><span class="pre">cl.members.observed</span></code>:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">cl</span><span class="o">.</span><span class="n">members</span><span class="o">.</span><span class="n">observed</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<div class="table-wrapper"><table border="1" class="dataframe">
<thead>
<tr style="text-align: right;">
<th></th>
<th>ra</th>
<th>dec</th>
<th>parallax</th>
<th>pmra</th>
<th>pmdec</th>
<th>parallax_pmra_corr</th>
<th>parallax_pmdec_corr</th>
<th>pmra_pmdec_corr</th>
<th>parallax_error</th>
<th>pmra_error</th>
<th>pmdec_error</th>
</tr>
</thead>
<tbody>
<tr>
<th>0</th>
<td>69.827908</td>
<td>15.519434</td>
<td>21.594203</td>
<td>100.148848</td>
<td>-26.160099</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.1</td>
<td>0.1</td>
<td>0.1</td>
</tr>
<tr>
<th>1</th>
<td>63.449065</td>
<td>18.338080</td>
<td>20.866021</td>
<td>116.734043</td>
<td>-26.047054</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.1</td>
<td>0.1</td>
<td>0.1</td>
</tr>
<tr>
<th>2</th>
<td>67.364160</td>
<td>20.868653</td>
<td>21.474773</td>
<td>97.400167</td>
<td>-43.817789</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.1</td>
<td>0.1</td>
<td>0.1</td>
</tr>
<tr>
<th>3</th>
<td>62.220135</td>
<td>16.061914</td>
<td>20.065537</td>
<td>116.387176</td>
<td>-26.138049</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.1</td>
<td>0.1</td>
<td>0.1</td>
</tr>
<tr>
<th>4</th>
<td>61.149763</td>
<td>17.653502</td>
<td>22.384763</td>
<td>125.056344</td>
<td>-28.292826</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.1</td>
<td>0.1</td>
<td>0.1</td>
</tr>
</tbody>
</table></div>
</div></div>
</div>
</section>
<section id="Perspective-effect">
<h2>Perspective effect<a class="headerlink" href="#Perspective-effect" title="Permalink to this headline">¶</a></h2>
<p>We can use this mock cluster class to quickly verify the perspective effect which arises from the fact that proper motions are motion reflected onto a sphere (the celectial sphere). Since velocity dispersion only adds noise to this effect, let’s make another cluster with zero dispersion but still sampling the exactly same star positions as the one we just made using <code class="docutils literal notranslate"><span class="pre">sample_at</span></code>:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[35]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">cl0</span> <span class="o">=</span> <span class="n">kn</span><span class="o">.</span><span class="n">Cluster</span><span class="p">([</span><span class="o">-</span><span class="mf">6.32</span><span class="p">,</span> <span class="mf">45.24</span><span class="p">,</span> <span class="mf">5.30</span><span class="p">],</span> <span class="mf">0.</span><span class="p">,</span> <span class="n">b0</span><span class="o">=</span><span class="n">b0</span><span class="p">)</span><span class="o">.</span><span class="n">sample_at</span><span class="p">(</span><span class="n">cl</span><span class="o">.</span><span class="n">members</span><span class="o">.</span><span class="n">truth</span><span class="o">.</span><span class="n">g</span><span class="o">.</span><span class="n">icrs</span><span class="p">)</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">cl0</span><span class="o">.</span><span class="n">members</span><span class="o">.</span><span class="n">truth</span>

<span class="n">fig</span><span class="p">,</span> <span class="p">(</span><span class="n">ax1</span><span class="p">,</span><span class="n">ax2</span><span class="p">)</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">quiver</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">'ra'</span><span class="p">],</span><span class="n">df</span><span class="p">[</span><span class="s1">'dec'</span><span class="p">],</span><span class="n">df</span><span class="p">[</span><span class="s1">'pmra'</span><span class="p">],</span><span class="n">df</span><span class="p">[</span><span class="s1">'pmdec'</span><span class="p">])</span>
<span class="n">dpmra</span><span class="p">,</span><span class="n">dpmdec</span> <span class="o">=</span> <span class="n">df</span><span class="p">[[</span><span class="s1">'pmra'</span><span class="p">,</span><span class="s1">'pmdec'</span><span class="p">]]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span><span class="n">x</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">x</span><span class="p">))</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">T</span>
<span class="n">ra</span><span class="p">,</span><span class="n">dec</span> <span class="o">=</span> <span class="n">df</span><span class="p">[[</span><span class="s1">'ra'</span><span class="p">,</span><span class="s1">'dec'</span><span class="p">]]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">T</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">quiver</span><span class="p">(</span><span class="n">ra</span><span class="p">,</span><span class="n">dec</span><span class="p">,</span><span class="n">dpmra</span><span class="p">,</span><span class="n">dpmdec</span><span class="p">)</span>
<span class="k">for</span> <span class="n">cax</span> <span class="ow">in</span> <span class="p">[</span><span class="n">ax1</span><span class="p">,</span><span class="n">ax2</span><span class="p">]:</span>
    <span class="n">cax</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">xlabel</span><span class="o">=</span><span class="s1">'RA'</span><span class="p">,</span><span class="n">ylabel</span><span class="o">=</span><span class="s1">'Dec'</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">"V=(pmra, pmdec)"</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">"V=($\Delta$pmra, $\Delta$pmdec)"</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/tutorial-mock_16_0.png" src="_images/tutorial-mock_16_0.png"/>
</div>
</div>
<p>While the overall proper motion is the same (left plot above) because all stars have the same velocity, in detail, they are projections of the velocity at different positions of the fictitious celestial sphere. So if you take out the mean and look at the residual proper motions (right plot above), the pattern is such that they are converging to a certain direction (ra, dec). This converging point is where the velocity vector becomes exactly radial, and the converging pattern is due to the fact
that the cluster is receding from us.</p>
<p>At the specified position (<code class="docutils literal notranslate"><span class="pre">b0</span></code>), the radial direction is more or less aligned with the <span class="math notranslate nohighlight">\(y\)</span>-axis. So if we reverse the sign of our <span class="math notranslate nohighlight">\(y\)</span> velocity and make the cluster to be approaching towards us, the residual proper motion now shows diverging pattern as we see below</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[36]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">cl0</span> <span class="o">=</span> <span class="n">kn</span><span class="o">.</span><span class="n">Cluster</span><span class="p">([</span><span class="o">-</span><span class="mf">6.32</span><span class="p">,</span> <span class="o">-</span><span class="mf">45.24</span><span class="p">,</span> <span class="mf">5.30</span><span class="p">],</span> <span class="mf">0.</span><span class="p">,</span> <span class="n">b0</span><span class="o">=</span><span class="n">b0</span><span class="p">)</span><span class="o">.</span><span class="n">sample_at</span><span class="p">(</span><span class="n">cl</span><span class="o">.</span><span class="n">members</span><span class="o">.</span><span class="n">truth</span><span class="o">.</span><span class="n">g</span><span class="o">.</span><span class="n">icrs</span><span class="p">)</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">cl0</span><span class="o">.</span><span class="n">members</span><span class="o">.</span><span class="n">truth</span>

<span class="n">fig</span><span class="p">,</span> <span class="p">(</span><span class="n">ax1</span><span class="p">,</span><span class="n">ax2</span><span class="p">)</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">quiver</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">'ra'</span><span class="p">],</span><span class="n">df</span><span class="p">[</span><span class="s1">'dec'</span><span class="p">],</span><span class="n">df</span><span class="p">[</span><span class="s1">'pmra'</span><span class="p">],</span><span class="n">df</span><span class="p">[</span><span class="s1">'pmdec'</span><span class="p">])</span>
<span class="n">dpmra</span><span class="p">,</span><span class="n">dpmdec</span> <span class="o">=</span> <span class="n">df</span><span class="p">[[</span><span class="s1">'pmra'</span><span class="p">,</span><span class="s1">'pmdec'</span><span class="p">]]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span><span class="n">x</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">x</span><span class="p">))</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">T</span>
<span class="n">ra</span><span class="p">,</span><span class="n">dec</span> <span class="o">=</span> <span class="n">df</span><span class="p">[[</span><span class="s1">'ra'</span><span class="p">,</span><span class="s1">'dec'</span><span class="p">]]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">T</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">quiver</span><span class="p">(</span><span class="n">ra</span><span class="p">,</span><span class="n">dec</span><span class="p">,</span><span class="n">dpmra</span><span class="p">,</span><span class="n">dpmdec</span><span class="p">)</span>
<span class="k">for</span> <span class="n">cax</span> <span class="ow">in</span> <span class="p">[</span><span class="n">ax1</span><span class="p">,</span><span class="n">ax2</span><span class="p">]:</span>
    <span class="n">cax</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">xlabel</span><span class="o">=</span><span class="s1">'RA'</span><span class="p">,</span><span class="n">ylabel</span><span class="o">=</span><span class="s1">'Dec'</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">"V=(pmra, pmdec)"</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">"V=($\Delta$pmra, $\Delta$pmdec)"</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/tutorial-mock_19_0.png" src="_images/tutorial-mock_19_0.png"/>
</div>
</div>
<p>This figure should also make you wonder, what if the cluster is contracting or expanding?</p>
</section>
<section id="Degeneracy-between-perspective-effect-and-isotropic-contraction/expansion">
<h2>Degeneracy between perspective effect and isotropic contraction/expansion<a class="headerlink" href="#Degeneracy-between-perspective-effect-and-isotropic-contraction/expansion" title="Permalink to this headline">¶</a></h2>
<p>Indeed, if we only have proper motions, we cannot tell the difference between the (istoropic) contractiong/expansion of the cluster and the perspective effect due to radial velocity. We show this below by making another mock cluster that looks the same in terms of their (residual) proper motions but that is actually stationary in the radial direction and instead contracting.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[165]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">def</span> <span class="nf">make_equivalent_cluster</span><span class="p">(</span><span class="n">cl</span><span class="p">):</span>
    <span class="sd">'''</span>
<span class="sd">    Make a cluster that has zero RV (not receding nor approaching)</span>
<span class="sd">    but is either expanding or contracting, resulting it to appear equivalent</span>
<span class="sd">    in terms of observed proper motions.</span>
<span class="sd">    '''</span>
    <span class="kn">import</span> <span class="nn">astropy.coordinates</span> <span class="k">as</span> <span class="nn">coord</span>
    <span class="n">b0</span><span class="p">,</span> <span class="n">v0</span> <span class="o">=</span> <span class="n">cl</span><span class="o">.</span><span class="n">b0</span><span class="p">,</span> <span class="n">cl</span><span class="o">.</span><span class="n">v0</span>
    <span class="n">c</span> <span class="o">=</span> <span class="n">coord</span><span class="o">.</span><span class="n">ICRS</span><span class="p">(</span><span class="o">*</span><span class="p">(</span><span class="n">b0</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">pc</span><span class="p">),</span> <span class="o">*</span><span class="p">(</span><span class="n">v0</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">km</span><span class="o">/</span><span class="n">u</span><span class="o">.</span><span class="n">s</span><span class="p">),</span>
                   <span class="n">representation_type</span><span class="o">=</span><span class="s1">'cartesian'</span><span class="p">,</span><span class="n">differential_type</span><span class="o">=</span><span class="s1">'cartesian'</span><span class="p">)</span><span class="o">.</span><span class="n">spherical</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">differentials</span><span class="p">[</span><span class="s1">'s'</span><span class="p">])</span>

    <span class="n">v0_rv0</span> <span class="o">=</span> <span class="n">coord</span><span class="o">.</span><span class="n">ICRS</span><span class="p">(</span>
        <span class="n">c</span><span class="o">.</span><span class="n">lon</span><span class="p">,</span><span class="n">c</span><span class="o">.</span><span class="n">lat</span><span class="p">,</span><span class="n">c</span><span class="o">.</span><span class="n">distance</span><span class="p">,</span><span class="n">c</span><span class="o">.</span><span class="n">differentials</span><span class="p">[</span><span class="s1">'s'</span><span class="p">]</span><span class="o">.</span><span class="n">d_lon</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">lat</span><span class="p">),</span>
        <span class="n">c</span><span class="o">.</span><span class="n">differentials</span><span class="p">[</span><span class="s1">'s'</span><span class="p">]</span><span class="o">.</span><span class="n">d_lat</span><span class="p">)</span><span class="o">.</span><span class="n">velocity</span><span class="o">.</span><span class="n">d_xyz</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">km</span><span class="o">/</span><span class="n">u</span><span class="o">.</span><span class="n">s</span><span class="p">)</span>

    <span class="n">rv</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">differentials</span><span class="p">[</span><span class="s1">'s'</span><span class="p">]</span><span class="o">.</span><span class="n">d_distance</span>
    <span class="n">kappa</span> <span class="o">=</span> <span class="n">rv</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">km</span><span class="o">/</span><span class="n">u</span><span class="o">.</span><span class="n">s</span><span class="p">)</span><span class="o">.</span><span class="n">value</span> <span class="o">/</span> <span class="n">c</span><span class="o">.</span><span class="n">distance</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">pc</span><span class="p">)</span><span class="o">.</span><span class="n">value</span> <span class="o">*</span> <span class="mf">1000.0</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">kappa</span><span class="p">)</span>


    <span class="n">cl_rv0</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">kn</span><span class="o">.</span><span class="n">Cluster</span><span class="p">(</span><span class="n">v0_rv0</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span>
                   <span class="n">b0</span><span class="o">=</span><span class="n">b0</span><span class="p">,</span><span class="n">T</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">([</span><span class="o">-</span><span class="n">kappa</span><span class="p">,</span><span class="o">-</span><span class="n">kappa</span><span class="p">,</span><span class="o">-</span><span class="n">kappa</span><span class="p">]))</span>
        <span class="o">.</span><span class="n">sample_at</span><span class="p">(</span><span class="n">cl</span><span class="o">.</span><span class="n">members</span><span class="o">.</span><span class="n">truth</span><span class="o">.</span><span class="n">g</span><span class="o">.</span><span class="n">icrs</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">cl_rv0</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[170]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">cl0</span> <span class="o">=</span> <span class="n">kn</span><span class="o">.</span><span class="n">Cluster</span><span class="p">([</span><span class="o">-</span><span class="mf">6.32</span><span class="p">,</span> <span class="mf">45.24</span><span class="p">,</span> <span class="mf">5.30</span><span class="p">],</span> <span class="mf">0.</span><span class="p">,</span> <span class="n">b0</span><span class="o">=</span><span class="n">b0</span><span class="p">)</span><span class="o">.</span><span class="n">sample_at</span><span class="p">(</span><span class="n">cl</span><span class="o">.</span><span class="n">members</span><span class="o">.</span><span class="n">truth</span><span class="o">.</span><span class="n">g</span><span class="o">.</span><span class="n">icrs</span><span class="p">)</span>
<span class="n">df0</span> <span class="o">=</span> <span class="n">cl0</span><span class="o">.</span><span class="n">members</span><span class="o">.</span><span class="n">truth</span>
<span class="n">cl_contracting</span> <span class="o">=</span><span class="n">make_equivalent_cluster</span><span class="p">(</span><span class="n">cl0</span><span class="p">)</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">cl_contracting</span><span class="o">.</span><span class="n">members</span><span class="o">.</span><span class="n">truth</span>

<span class="n">fig</span><span class="p">,</span> <span class="p">((</span><span class="n">ax11</span><span class="p">,</span><span class="n">ax12</span><span class="p">),(</span><span class="n">ax21</span><span class="p">,</span><span class="n">ax22</span><span class="p">))</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">8</span><span class="p">),</span><span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">sharey</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">ax11</span><span class="o">.</span><span class="n">quiver</span><span class="p">(</span><span class="n">df0</span><span class="p">[</span><span class="s1">'ra'</span><span class="p">],</span><span class="n">df0</span><span class="p">[</span><span class="s1">'dec'</span><span class="p">],</span><span class="n">df0</span><span class="p">[</span><span class="s1">'pmra'</span><span class="p">],</span><span class="n">df0</span><span class="p">[</span><span class="s1">'pmdec'</span><span class="p">])</span>
<span class="n">dpmra</span><span class="p">,</span><span class="n">dpmdec</span> <span class="o">=</span> <span class="n">df0</span><span class="p">[[</span><span class="s1">'pmra'</span><span class="p">,</span><span class="s1">'pmdec'</span><span class="p">]]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span><span class="n">x</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">x</span><span class="p">))</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">T</span>
<span class="n">ra</span><span class="p">,</span><span class="n">dec</span> <span class="o">=</span> <span class="n">df0</span><span class="p">[[</span><span class="s1">'ra'</span><span class="p">,</span><span class="s1">'dec'</span><span class="p">]]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">T</span>
<span class="n">ax12</span><span class="o">.</span><span class="n">quiver</span><span class="p">(</span><span class="n">ra</span><span class="p">,</span><span class="n">dec</span><span class="p">,</span><span class="n">dpmra</span><span class="p">,</span><span class="n">dpmdec</span><span class="p">,</span> <span class="p">)</span>


<span class="n">ax21</span><span class="o">.</span><span class="n">quiver</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">'ra'</span><span class="p">],</span><span class="n">df</span><span class="p">[</span><span class="s1">'dec'</span><span class="p">],</span><span class="n">df</span><span class="p">[</span><span class="s1">'pmra'</span><span class="p">],</span><span class="n">df</span><span class="p">[</span><span class="s1">'pmdec'</span><span class="p">])</span>
<span class="n">dpmra</span><span class="p">,</span><span class="n">dpmdec</span> <span class="o">=</span> <span class="n">df</span><span class="p">[[</span><span class="s1">'pmra'</span><span class="p">,</span><span class="s1">'pmdec'</span><span class="p">]]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span><span class="n">x</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">x</span><span class="p">))</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">T</span>
<span class="n">ra</span><span class="p">,</span><span class="n">dec</span> <span class="o">=</span> <span class="n">df</span><span class="p">[[</span><span class="s1">'ra'</span><span class="p">,</span><span class="s1">'dec'</span><span class="p">]]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">T</span>
<span class="n">ax22</span><span class="o">.</span><span class="n">quiver</span><span class="p">(</span><span class="n">ra</span><span class="p">,</span><span class="n">dec</span><span class="p">,</span><span class="n">dpmra</span><span class="p">,</span><span class="n">dpmdec</span><span class="p">,</span> <span class="p">)</span>
<span class="n">ax11</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">"V=(pmra, pmdec)"</span><span class="p">)</span>
<span class="n">ax12</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">"V=($\Delta$pmra, $\Delta$pmdec)"</span><span class="p">)</span>
<span class="n">ax11</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">ylabel</span><span class="o">=</span><span class="s2">"recedeing cluster"</span><span class="p">)</span>
<span class="n">ax21</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">ylabel</span><span class="o">=</span><span class="s2">"contracting cluster"</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(66.75107646, 16.52048667, 46.77200017) (deg, deg, pc)
(111.32538582, -27.19257586, 38.96591964) (mas / yr, mas / yr, km / s)
833.1035554621004
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/tutorial-mock_24_1.png" src="_images/tutorial-mock_24_1.png"/>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[175]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># check the individual values of stars at the same position are actually the same</span>
<span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">'pmra'</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span><span class="n">df0</span><span class="p">[</span><span class="s1">'pmra'</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">'pmdec'</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span><span class="n">df0</span><span class="p">[</span><span class="s1">'pmdec'</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>As you can see from comparing plots on the top row (the default receding cluster) and the bottom row (stationary in distance but contracting), in terms of astrometric parameters, the two are indistinguishable. In other words, there is a degeneracy between radial component of the mean velocity and the isotropic expansion/contraction.</p>
<p>However, if we have precise radial velocities even for some of these stars, we may hope to break that degeneracy and constrain the internal motion of the cluster.</p>
<p>On the other hand, if we are willing to assume that there is no expansion or contraction, we can back out the radial component of the cluster’s mean velocity from proper motions. This <em>astrometric</em> radial velocity is purely from geomeric projection effect as opposed to spectroscopic ones that are derived from the Doppler shift of spectral lines.</p>
</section>
<section id="Effect-of-internal-velocity-gradient">
<h2>Effect of internal velocity gradient<a class="headerlink" href="#Effect-of-internal-velocity-gradient" title="Permalink to this headline">¶</a></h2>
<p>So what if the cluster is rotating around <span class="math notranslate nohighlight">\(z\)</span>-axis? What effect would it introduce to the observables?</p>
<p>We can again make another mock cluster sampling the same positions but this time giving it a little rotation of 300 m/s/pc.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[195]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">cl0</span> <span class="o">=</span> <span class="n">kn</span><span class="o">.</span><span class="n">Cluster</span><span class="p">([</span><span class="o">-</span><span class="mf">6.32</span><span class="p">,</span> <span class="mf">45.24</span><span class="p">,</span> <span class="mf">5.30</span><span class="p">],</span> <span class="mf">0.</span><span class="p">,</span> <span class="n">b0</span><span class="o">=</span><span class="n">b0</span><span class="p">)</span><span class="o">.</span><span class="n">sample_at</span><span class="p">(</span><span class="n">cl</span><span class="o">.</span><span class="n">members</span><span class="o">.</span><span class="n">truth</span><span class="o">.</span><span class="n">g</span><span class="o">.</span><span class="n">icrs</span><span class="p">)</span>
<span class="n">df0</span> <span class="o">=</span> <span class="n">cl0</span><span class="o">.</span><span class="n">members</span><span class="o">.</span><span class="n">truth</span>
<span class="n">clrot</span> <span class="o">=</span> <span class="n">kn</span><span class="o">.</span><span class="n">Cluster</span><span class="p">([</span><span class="o">-</span><span class="mf">6.32</span><span class="p">,</span> <span class="mf">45.24</span><span class="p">,</span> <span class="mf">5.30</span><span class="p">],</span> <span class="mf">0.</span><span class="p">,</span> <span class="n">b0</span><span class="o">=</span><span class="n">b0</span><span class="p">,</span> <span class="n">omegas</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mf">300.</span><span class="p">])</span><span class="o">.</span><span class="n">sample_at</span><span class="p">(</span><span class="n">cl</span><span class="o">.</span><span class="n">members</span><span class="o">.</span><span class="n">truth</span><span class="o">.</span><span class="n">g</span><span class="o">.</span><span class="n">icrs</span><span class="p">)</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">clrot</span><span class="o">.</span><span class="n">members</span><span class="o">.</span><span class="n">truth</span>

<span class="n">fig</span><span class="p">,</span> <span class="p">(</span><span class="n">ax1</span><span class="p">,</span><span class="n">ax2</span><span class="p">,</span><span class="n">ax3</span><span class="p">)</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">quiver</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">'ra'</span><span class="p">],</span><span class="n">df</span><span class="p">[</span><span class="s1">'dec'</span><span class="p">],</span><span class="n">df</span><span class="p">[</span><span class="s1">'pmra'</span><span class="p">],</span><span class="n">df</span><span class="p">[</span><span class="s1">'pmdec'</span><span class="p">])</span>
<span class="n">dpmra0</span><span class="p">,</span><span class="n">dpmdec0</span> <span class="o">=</span> <span class="n">df0</span><span class="p">[[</span><span class="s1">'pmra'</span><span class="p">,</span><span class="s1">'pmdec'</span><span class="p">]]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span><span class="n">x</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">x</span><span class="p">))</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">T</span>
<span class="n">dpmrarot</span><span class="p">,</span><span class="n">dpmdecrot</span> <span class="o">=</span> <span class="n">df</span><span class="p">[[</span><span class="s1">'pmra'</span><span class="p">,</span><span class="s1">'pmdec'</span><span class="p">]]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span><span class="n">x</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">x</span><span class="p">))</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">T</span>
<span class="c1"># take out perspective effect exactly</span>
<span class="n">dpmrarot1</span><span class="p">,</span><span class="n">dpmdecrot1</span> <span class="o">=</span> <span class="p">(</span><span class="n">df</span><span class="p">[[</span><span class="s1">'pmra'</span><span class="p">,</span><span class="s1">'pmdec'</span><span class="p">]]</span> <span class="o">-</span> <span class="n">df0</span><span class="p">[[</span><span class="s1">'pmra'</span><span class="p">,</span><span class="s1">'pmdec'</span><span class="p">]])</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">T</span>

<span class="n">ra</span><span class="p">,</span><span class="n">dec</span> <span class="o">=</span> <span class="n">df</span><span class="p">[[</span><span class="s1">'ra'</span><span class="p">,</span><span class="s1">'dec'</span><span class="p">]]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">T</span>

<span class="n">ax2</span><span class="o">.</span><span class="n">quiver</span><span class="p">(</span><span class="n">ra</span><span class="p">,</span><span class="n">dec</span><span class="p">,</span><span class="n">dpmra0</span><span class="p">,</span><span class="n">dpmdec0</span><span class="p">,</span><span class="n">scale_units</span><span class="o">=</span><span class="s1">'inches'</span><span class="p">,</span><span class="n">scale</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">'gray'</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">quiver</span><span class="p">(</span><span class="n">ra</span><span class="p">,</span><span class="n">dec</span><span class="p">,</span><span class="n">dpmrarot</span><span class="p">,</span><span class="n">dpmdecrot</span><span class="p">,</span><span class="n">scale_units</span><span class="o">=</span><span class="s1">'inches'</span><span class="p">,</span><span class="n">scale</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">'k'</span><span class="p">)</span>

<span class="n">ax2</span><span class="o">.</span><span class="n">quiver</span><span class="p">(</span><span class="n">ra</span><span class="p">,</span><span class="n">dec</span><span class="p">,</span><span class="n">dpmrarot1</span><span class="p">,</span><span class="n">dpmdecrot1</span><span class="p">,</span><span class="n">scale_units</span><span class="o">=</span><span class="s1">'inches'</span><span class="p">,</span><span class="n">scale</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">'C2'</span><span class="p">)</span>
<span class="n">ax3</span><span class="o">.</span><span class="n">quiver</span><span class="p">(</span><span class="n">ra</span><span class="p">,</span><span class="n">dec</span><span class="p">,</span><span class="n">dpmrarot1</span><span class="p">,</span><span class="n">dpmdecrot1</span><span class="p">,</span><span class="n">scale_units</span><span class="o">=</span><span class="s1">'inches'</span><span class="p">,</span><span class="n">scale</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">'C2'</span><span class="p">)</span>

<span class="k">for</span> <span class="n">cax</span> <span class="ow">in</span> <span class="p">[</span><span class="n">ax1</span><span class="p">,</span><span class="n">ax2</span><span class="p">,</span><span class="n">ax3</span><span class="p">]:</span>
    <span class="n">cax</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">xlabel</span><span class="o">=</span><span class="s1">'RA'</span><span class="p">,</span><span class="n">ylabel</span><span class="o">=</span><span class="s1">'Dec'</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">"V=(pmra, pmdec)"</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">"V=($\Delta$pmra, $\Delta$pmdec)"</span><span class="p">)</span>
<span class="n">ax3</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">"V=($\Delta$pmra$_{-0}$, $\Delta$pmdec$_{-0}}$)"</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/tutorial-mock_29_0.png" src="_images/tutorial-mock_29_0.png"/>
</div>
</div>
<p>In the middle plot, we see that such small rotation will only deflect the residual proper motion slightly from the one without the rotation (perspective effect only; gray arrows) by the little red arrows. In other words, the vector some of gray and red arrows give our observed proper motion (black arrows).</p>
<p>If we separate out the perspective effect and only look at the effect of rotation (the right plot above), we can see the anti-symmetric pattern distinctive of rotation more clearly. The right quiver plot is made with 1/3 scale length of the middle to highlight these small vectors.</p>
<p>It’s clear that the relative importance of the perspective effect of the mean velocity versus any internal velocity gradient (shear or rotation) depends on the cluster parameters.</p>
</section>
</section>

      </article>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="tutorial.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">Getting started with Kinesis</div>
              </div>
              <svg><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="install.html">
              <svg><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">Installing kinesis</div>
                
              </div>
            </a>
        </div>

        <div class="related-information">
              Copyright &#169; 2019-2021, Semyeong Oh
            |
            Built with <a href="https://www.sphinx-doc.org/">Sphinx</a>
              and
              <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
              <a href="https://github.com/pradyunsg/furo">Furo theme</a>.
            |
            <a class="muted-link" href="_sources/tutorial-mock.ipynb.txt"
               rel="nofollow">
              Show Source
            </a>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            Contents
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">Making a mock cluster</a><ul>
<li><a class="reference internal" href="#Making-and-observing-a-mock-cluster">Making and observing a mock cluster</a></li>
<li><a class="reference internal" href="#Perspective-effect">Perspective effect</a></li>
<li><a class="reference internal" href="#Degeneracy-between-perspective-effect-and-isotropic-contraction/expansion">Degeneracy between perspective effect and isotropic contraction/expansion</a></li>
<li><a class="reference internal" href="#Effect-of-internal-velocity-gradient">Effect of internal velocity gradient</a></li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/scripts/main.js"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    </body>
</html>